<html>
        <head>
	        <link rel="stylesheet" type="text/css" href="/pages/css/oldglobal.css">
		<title>Video List</title>
	</head>
	<body><header>
		<div>
			<div>
				<span>GoLegacy Version <%= it.env.WRAPPER_VER %></span>
			</div>
			<div>
				<div class="char_dropdown button_small">
					<div>UPLOAD</div>
					<menu>
						<a onclick="document.getElementById('file2').click()">Starter</a>
						<a onclick="document.getElementById('file').click()">Movie</a>
					</menu>
				</div>
				<a class="button_small" href="/create?filter=cc">CREATE A CHARACTER</a>
				<a class="button_big" href="/create">MAKE A VIDEO</a>
			</div>
		</div>
		<div class="warning">Welcome to GoLegacy! Feel free to do whatever you want here.</div>
	</header>
	<table>
		<thead>
			<tr>
				<td></td>
				<td>Video Title</td>
				<td>Last Modified</td>
				<td></td>
			</tr>
		</thead>
		<tbody></tbody>
		<tfoot>
			<tr>
				<td colspan="127">
					<a id="load_more" href="javascript:;">LOAD MORE...</a>
				</td>
			</tr>
		</tfoot>
	</table>
	<center>
		<h1 id="watermark-settings">Watermark Settings</h1>
		<button onclick="document.getElementById('file3').click()">Upload Logo</button>
	</center>
	<form enctype='multipart/form-data' action='/upload_starter' method='post'>
		<input id='file2' type="file" onchange="this.form.submit()" name='import' accept=".xml" />
	</form>
	<form enctype='multipart/form-data' action='/upload_watermark' method='post'>
		<input id='file3' type="file" onchange="this.form.submit()" name='import' accept=".png,.jpg,.swf" />
	</form>
	<form enctype='multipart/form-data' action='/upload_movie' method='post'>
		<input id='file' type="file" onchange="this.form.submit()" name='import' accept=".xml" />
	</form>
	<script>
		var json;
		var tbody = document.getElementsByTagName('tbody')[0];
		var loadMore = document.getElementById('load_more');
		const listReq = new XMLHttpRequest();
		listReq.open('GET', '/movieList');
		listReq.send();

		var C = 0;
		function loadRows() {
			let c = C; C += 69;
			for (; c < C; c++) {
				if (c > json.length - 1) loadMore.remove();
				const tbl = json[c];
				const date = tbl.date.substr(0, 10) + ' ' + tbl.date.substr(11);
				var htmlFunction;
				if (!c > json) {
					alert("There are currently no videos at the moment. you will now be redirected to the studio.");
					location.href = '/go_full';
				} else tbody.insertAdjacentHTML('beforeend', '<tr id="' + tbl.id + '"><td><img src="/movie_thumbs/' + tbl.id + '"></td><td><div>' + tbl.title.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;") + '</div><div>' + tbl.durationString + '</div><div>' + tbl.desc + '</div><div>Video Tags: ' + tbl.tag + '</div><div>Watermark: ' + tbl.watermark + '</div><div>Video Res: ' + tbl.res + '</td><td><span>' + date + '</span></td><td><a onclick="popup(\'' + tbl.id + '\', \'' + tbl.wide + '\')"></a><a onclick="studioRedirect(\'' + tbl.id + '\', \'' + tbl.wide + '\')"></a><a href="/movies/' + tbl.id + '.xml" download="' + tbl.title + '"></a><a onclick="deleteMovie(\'' + tbl.id + '\')"></a></td></tr>');
			}
		}

		loadMore.onclick = loadRows;
		listReq.onreadystatechange = function (e) {
			if (listReq.readyState != 4) return;
			json = JSON.parse(listReq.responseText);
			loadRows();
		}

		function popup(id, wide) {
			window.open('/player?movieId=' + id + '&isWide=' + wide, 'MsgWindow', 'width=1280,height=723,left=' + (screen.width / 2 - 640) + ',top=' + (screen.height / 2 - 360));
		}
		
		function studioRedirect(id, wide) {
			location.href = `/go_full?movieId=${id}&isWide=${wide}`;
		}
		
		function deleteMovie(id) {
			const xhttp = new XMLHttpRequest();
		        xhttp.open('GET', `/api/movie/delete/${id}`);
		        xhttp.send();
                        document.getElementById(`${id}`).style.display = "none";
		}
	</script>
	</body>
</html>
